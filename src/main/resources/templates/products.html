<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SuperShop - Products</title>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f7f8fa; margin: 0; padding: 0; }
        header { background-color: #232f3e; color: white; padding: 15px 30px; display: flex; align-items: center; justify-content: space-between; }
        header h1 { font-size: 22px; font-weight: 600; margin: 0; }
        header a { color: white; text-decoration: none; margin-left: 20px; font-size: 15px; }
        .categories { background-color: #fff; display: flex; gap: 20px; padding: 10px 20px; overflow-x: auto; border-bottom: 1px solid #ddd; }
        .categories button { background-color: #f0f0f0; border: none; padding: 8px 18px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .categories button:hover { background-color: #232f3e; color: white; }
        .products-container { padding: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; }
        .product-card { background-color: #fff; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); overflow: hidden; transition: 0.3s; }
        .product-card:hover { transform: scale(1.03); box-shadow: 0 5px 12px rgba(0,0,0,0.15); }
        .product-card img { width: 100%; height: 240px; object-fit: cover; }
        .product-info { padding: 15px; }
        .product-info h3 { font-size: 16px; font-weight: 600; color: #333; margin: 0 0 5px 0; }
        .product-info p { color: #777; font-size: 14px; margin: 4px 0; }
        .price { color: #b12704; font-weight: bold; font-size: 15px; }
        .buy-btn { background-color: #febd69; border: none; padding: 10px 15px; width: 100%; font-weight: 600; cursor: pointer; border-radius: 8px; margin-top: 8px; }
        .buy-btn:hover { background-color: #f90; }
    </style>
</head>
<body>

<header>
    <h1>üõçÔ∏è SuperShop</h1>
    <nav>
        <a th:href="@{/products}">Home</a>
        <a th:href="@{/cart}">Cart</a>
        <a th:href="@{/logout}">Logout</a>
    </nav>
</header>

<!-- Category Buttons -->
<div class="categories">
    <button onclick="filterCategory('All')">All</button>
    <button onclick="filterCategory('Men')">Men</button>
    <button onclick="filterCategory('Women')">Women</button>
    <button onclick="filterCategory('Kids')">Kids</button>
    <button onclick="filterCategory('Shoes')">Shoes</button>
    <button onclick="filterCategory('Accessories')">Accessories</button>
    <button onclick="filterCategory('Sportswear')">Sportswear</button>
    <button onclick="filterCategory('Casuals')">Casuals</button>
    <button onclick="filterCategory('Traditional')">Traditional</button>
</div>

<div class="products-container" id="productsContainer">
    <!-- Thymeleaf loop for products from DB -->
    <div th:each="product : ${products}"
         class="product-card"
         th:attr="data-category=${product.category}"
         th:data-id="${product.id}">
        <img th:src="@{${product.imageUrl}}" th:alt="${product.name}"/>
        <div class="product-info">
            <h3 th:text="${product.name}">Product Name</h3>
            <p class="price" th:text="'Ksh ' + ${product.price}">1200</p>
            <p th:text="${product.description}">Description</p>
            <button class="buy-btn" th:attr="data-id=${product.id}">Add to Cart</button>
        </div>
    </div>

    <!-- Inline test products (fallback for testing) -->
    <div class="product-card" data-category="Men" data-id="101">
        <img src="/images/products/mens_casual_shirt.jpg" alt="Men's Casual Shirt"/>
        <div class="product-info">
            <h3>Men's Casual Shirt</h3>
            <p class="price">Ksh 1500</p>
            <p>Comfortable cotton shirt</p>
            <button class="buy-btn" data-id="101">Add to Cart</button>
        </div>
    </div>

    <div class="product-card" data-category="Women" data-id="102">
        <img src="/images/products/womens_summer_dress.jpg" alt="Women's Summer Dress"/>
        <div class="product-info">
            <h3>Women's Summer Dress</h3>
            <p class="price">Ksh 2000</p>
            <p>Floral summer dress</p>
            <button class="buy-btn" data-id="102">Add to Cart</button>
        </div>
    </div>

    <div class="product-card" data-category="Shoes" data-id="103">
        <img src="/images/products/mens_running_shoes.jpg" alt="Men's Running Shoes"/>
        <div class="product-info">
            <h3>Men's Running Shoes</h3>
            <p class="price">Ksh 3000</p>
            <p>Lightweight running shoes</p>
            <button class="buy-btn" data-id="103">Add to Cart</button>
        </div>
    </div>

    <div class="product-card" data-category="Kids" data-id="104">
        <img src="/images/products/kids_tshirt.jpg" alt="Kids T-Shirt"/>
        <div class="product-info">
            <h3>Kids T-Shirt</h3>
            <p class="price">Ksh 1000</p>
            <p>Soft cotton t-shirt</p>
            <button class="buy-btn" data-id="104">Add to Cart</button>
        </div>
    </div>
</div>

<script>
    // Filter products by category
    function filterCategory(category) {
        document.querySelectorAll('.product-card').forEach(card => {
            card.style.display = (category === 'All' || card.dataset.category === category) ? 'block' : 'none';
        });
    }

    // Add to cart
    document.querySelectorAll('.buy-btn').forEach(button => {
        button.addEventListener('click', async (e) => {
            e.preventDefault();
            const productId = button.dataset.id;
            try {
                const response = await fetch(`/api/cart/add/${productId}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                if (response.ok) {
                    alert('Product added to cart!');
                } else {
                    const text = await response.text();
                    alert('Failed to add product: ' + text);
                }
            } catch (err) {
                console.error(err);
                alert('Error adding product to cart.');
            }
        });
    });
</script>

</body>
</html>
